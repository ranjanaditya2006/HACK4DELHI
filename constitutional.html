<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NIRVACHANNEX – Constitutional simulator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="ui-system.css" />
  <style>
    /* Pop-up Tooltip Style (Bottom-Left) */
    #chart-tooltip {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 280px;
      background: rgba(10, 15, 30, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(8px);
      z-index: 1000;
      display: none;
      pointer-events: none;
      font-family: 'Inter', system-ui, sans-serif;
      animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .tooltip-header {
      font-size: 0.95rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .tooltip-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
      font-size: 0.85rem;
      color: #94a3b8;
    }
    
    .tooltip-val {
      color: #e2e8f0;
      font-weight: 600;
    }

    .bar {
      transition: height 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="brand-block">
        <div class="brand-logo">
          <img src="nirvachan logo.jpg" alt="NirvachanNex logo" />
        </div>
        <div>
          <div class="brand-text-main">NIRVACHANNEX</div>
          <div class="brand-text-sub">ONE NATION · ONE ELECTION</div>
        </div>
      </div>
      <nav class="app-nav">
        <a class="nav-pill nav-active" href="overview.html">Overview</a>
        <a class="nav-pill nav-active" href="governance.html">Governance</a>
        <a class="nav-pill nav-active" href="administrative.html">Administrative</a>
        <a class="nav-pill nav-active" href="financial.html">Financial</a>
        <a class="nav-pill nav-active" href="constitutional.html">Constitutional</a>
        <a href="delhi.html" class="nav-pill nav-active">Delhi Model</a>
        <a class="nav-pill nav-active" href="stakeholders.html">Stakeholders</a>
        <a class="nav-pill nav-active" href="federalism-solution.html">Federal Model </a>
        <a class="nav-pill nav-active" href="hung-assembly-solution.html">Fallback</a>
      </nav>
    </header>

    <main class="overview-grid">
      <section class="glass-panel">
        <div class="panel-glow"></div>
        <div class="panel-header">
          <div class="panel-title-block">
            <div class="panel-title">System‑level constitutional stability</div>
            <div class="panel-subtitle">
              Bars show how early dissolutions and resynchronisation strictness translate into ONOE stability over 20 years.
            </div>
          </div>
          <div class="panel-tag">Constitutional module</div>
        </div>

        <div class="scenario-strip">
          <div class="scenario-badge">
            Adjust sliders; trajectory bars and stress score update instantly. This is an analytical, not legal, model.
          </div>
        </div>

        <div class="kpi-grid" id="const-kpi-grid"></div>

        <div class="chart-section">
          <div class="chart-shell">
            <div class="chart-header-text">
              20‑year constitutional trajectory
            </div>
            <div class="chart-subtext">
              Hover each bar to see what it means: exceptional polls, time under alignment, and term adjustments.
            </div>
            <div class="chart-area">
              <div class="chart-grid"></div>
              <div class="chart-inner">
                <div class="chart-root" id="const-chart-root"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="verdict-text" id="const-verdict"></div>
      </section>

      <section class="glass-panel-soft">
        <div class="right-panel-inner">
          <h2 style="font-size:0.92rem;margin-bottom:4px;">Constitutional controls</h2>
          <p class="right-intro">
            Use these to stress‑test how fragile or robust your ONOE design is to political shocks.
          </p>

          <div class="metric-stack">
            <div class="metric-card">
              <div class="metric-top">
                <div class="metric-title">Early dissolutions every 5 yrs</div>
                <div class="metric-icon" style="background:linear-gradient(135deg,#ffc857,#ff8f57);">
                  D
                </div>
              </div>
              <div class="metric-value"><span id="const-diss-label">3</span></div>
              <div class="metric-caption">
                Average count of State/House dissolutions per 5‑year cycle across the union.
              </div>
              <input id="const-diss-slider" type="range" min="0" max="8" step="1" value="3" style="width:100%;margin-top:6px;" />
            </div>

            <div class="metric-card">
              <div class="metric-top">
                <div class="metric-title">Resynchronisation strictness</div>
                <div class="metric-icon" style="background:linear-gradient(135deg,#9c6bff,#4ef2ff);">
                  S
                </div>
              </div>
              <div class="metric-value"><span id="const-strict-label">60</span> /100</div>
              <div class="metric-caption">
                How aggressively exceptional elections are pulled back to the main ONOE cycle.
              </div>
              <input id="const-strict-slider" type="range" min="20" max="100" step="5" value="60" style="width:100%;margin-top:6px;" />
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer>© 2025 NirvachanNex – Constitutional Simulator</footer>
  </div>

  <div id="chart-tooltip"></div>

  <script>
    const constParams = { dissolutions: 3, strict: 60 };

    function computeConstMetrics() {
      const d = constParams.dissolutions;
      const s = constParams.strict;

      const outOfCycle20y = d * (1 - s / 120) * 4;
      const syncShare =
        Math.max(0, Math.min(100, 90 - d * 3 + s * 0.2 - outOfCycle20y * 1.5));
      const termAdjust =
        Math.max(0, Math.min(18, d * (s / 100) * 1.2));

      const stress =
        (outOfCycle20y / 20) * 40 +
        (1 - syncShare / 100) * 40 +
        (termAdjust / 18) * 20;

      return { outOfCycle20y, syncShare, termAdjust, stress };
    }

    const constKpiGrid   = document.getElementById("const-kpi-grid");
    const constChartRoot = document.getElementById("const-chart-root");
    const constVerdict   = document.getElementById("const-verdict");
    const tooltipElConst = document.getElementById("chart-tooltip");

    function showConstTooltip(data, type) {
      let content = "";
      
      // Define colors based on bar type (matching the CSS classes used below)
      let valColor = "#e2e8f0"; // default
      if(type === 'cycle') valColor = "#d946ef"; // purple/pink
      if(type === 'sync')  valColor = "#88ffea"; // cyan/teal
      if(type === 'term')  valColor = "#4ef2ff"; // bright blue

      if (type === 'cycle') {
          content = `
            <div class="tooltip-header">Out-of-Cycle Elections</div>
            <div class="tooltip-row">
               <span>Expected Count (20 yrs):</span>
               <span class="tooltip-val" style="color:${valColor}">${data.val.toFixed(1)}</span>
            </div>
            <div class="tooltip-row">
               <span>Impact:</span>
               <span class="tooltip-val">Erodes single-window promise</span>
            </div>
          `;
      } else if (type === 'sync') {
          content = `
            <div class="tooltip-header">Time Under Alignment</div>
            <div class="tooltip-row">
               <span>Sync Share:</span>
               <span class="tooltip-val" style="color:${valColor}">${data.val.toFixed(1)}%</span>
            </div>
            <div class="tooltip-row">
               <span>Benefit:</span>
               <span class="tooltip-val">Preserves governance & cost savings</span>
            </div>
          `;
      } else if (type === 'term') {
          content = `
            <div class="tooltip-header">Term Adjustment</div>
            <div class="tooltip-row">
               <span>Avg Adjustment:</span>
               <span class="tooltip-val" style="color:${valColor}">${data.val.toFixed(1)} months</span>
            </div>
            <div class="tooltip-row">
               <span>Risk:</span>
               <span class="tooltip-val">Political legitimacy concerns</span>
            </div>
          `;
      }

      tooltipElConst.innerHTML = content;
      tooltipElConst.style.display = "block";
    }

    function hideConstTooltip() { tooltipElConst.style.display = "none"; }

    function renderConstKPIs() {
      constKpiGrid.innerHTML = "";
      const m = computeConstMetrics();

      const cards = [
        { label: "Out‑of‑cycle elections (20 yrs)", value: m.outOfCycle20y, unit: "" },
        { label: "Time under aligned cycles",      value: m.syncShare,     unit: " %" },
        { label: "Avg term adjustment",            value: m.termAdjust,    unit: " months" },
        { label: "Design stress score",            value: m.stress,        unit: " /100" }
      ];

      cards.forEach(c => {
        const div = document.createElement("div");
        div.className = "kpi-card";
        div.innerHTML = `
          <div class="kpi-label">${c.label}</div>
          <div class="kpi-value">${c.value.toFixed(1)}${c.unit}</div>
          <div class="kpi-delta">
            Live value from sliders; interpret with governance and financial tabs.
          </div>`;
        constKpiGrid.appendChild(div);
      });
    }

    function renderConstChart() {
      constChartRoot.innerHTML = "";
      const m = computeConstMetrics();

      const height = constChartRoot.clientHeight || 160;
      const barWidth = 32;
      const totalWidth = constChartRoot.clientWidth || 400;
      const count = 3;
      const x0 = 30;
      const gap =
        (totalWidth - x0 * 2 - barWidth * count) /
        Math.max(count - 1, 1);

      const items = [
        { label: "Out‑of‑cycle", val: m.outOfCycle20y, max: 20,  cls: "bar-secondary", type: 'cycle' },
        { label: "Sync share",   val: m.syncShare,     max: 100, cls: "bar-sync",      type: 'sync' },
        { label: "Term adjust",  val: m.termAdjust,    max: 18,  cls: "bar-current",   type: 'term' }
      ];

      items.forEach((b, idx) => {
        const xBase = x0 + idx * (barWidth + gap);
        const h = (b.val / b.max) * (height * 0.9);

        const bar = document.createElement("div");
        bar.className = "bar " + b.cls;
        bar.style.left = xBase + "px";
        bar.style.width = barWidth + "px";
        bar.style.height = h + "px";

        // New Event Listeners for Pop-up Tooltip
        bar.addEventListener("mousemove", () => showConstTooltip(b, b.type));
        bar.addEventListener("mouseleave", hideConstTooltip);

        constChartRoot.appendChild(bar);

        const label = document.createElement("div");
        label.className = "bar-label";
        label.style.left = xBase + barWidth / 2 + "px";
        label.style.bottom = "-18px";
        label.textContent = b.label;
        constChartRoot.appendChild(label);

        const val = document.createElement("div");
        val.className = "bar-value";
        val.style.left = xBase + barWidth / 2 + "px";
        val.style.bottom = h + 6 + "px";
        val.textContent =
          b.label === "Sync share"
            ? b.val.toFixed(1) + "%"
            : b.val.toFixed(1);
        constChartRoot.appendChild(val);
      });

      constVerdict.textContent =
        "With " +
        constParams.dissolutions +
        " dissolutions per 5‑year cycle and strictness " +
        constParams.strict +
        "/100, ONOE would face roughly " +
        m.outOfCycle20y.toFixed(1) +
        " out‑of‑cycle elections over 20 years, stay aligned about " +
        m.syncShare.toFixed(1) +
        "% of the time, and require around " +
        m.termAdjust.toFixed(1) +
        " months of average term engineering (design stress " +
        m.stress.toFixed(1) +
        "/100).";
    }

    function renderConstAll() {
      renderConstKPIs();
      renderConstChart();
    }

    document.getElementById("const-diss-slider").oninput = e => {
      constParams.dissolutions = Number(e.target.value);
      document.getElementById("const-diss-label").textContent = e.target.value;
      renderConstAll();
    };

    document.getElementById("const-strict-slider").oninput = e => {
      constParams.strict = Number(e.target.value);
      document.getElementById("const-strict-label").textContent = e.target.value;
      renderConstAll();
    };

    window.addEventListener("resize", renderConstChart);
    renderConstAll();
  </script>
</body>
</html>
