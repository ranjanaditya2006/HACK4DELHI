<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NIRVACHANNEX – ONOE Scenario Overview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="ui-system.css" />
</head>
<body>
  <div class="app-shell">
    <!-- Header -->
    <header class="app-header">
      <div class="brand-block">
        <div class="brand-logo">
          <img src="nirvachan logo.jpg" alt="NirvachanNex logo" />
        </div>
        <div>
          <div class="brand-text-main">NIRVACHANNEX</div>
          <div class="brand-text-sub">ONE NATION · ONE ELECTION</div>
        </div>
      </div>
      <nav class="app-nav">
        <a class="nav-pill nav-active" href="overview.html">Overview</a>
        <a class="nav-pill" href="governance.html">Governance</a>
        <a class="nav-pill" href="administrative.html">Administrative</a>
        <a class="nav-pill" href="financial.html">Financial</a>
        <a class="nav-pill" href="constitutional.html">Constitutional</a>
        <a href="delhi.html" class="nav-pill">Delhi Module</a>
        

      </nav>
    </header>

    <main class="overview-grid">
      <!-- LEFT: main scenario view -->
      <section class="glass-panel">
        <div class="panel-glow"></div>
        <div class="panel-header">
          <div class="panel-title-block">
            <div class="panel-title">Scenario overview</div>
            <div class="panel-subtitle">
              Compare governance, administrative, financial, and constitutional signals for the current staggered
              system versus a synchronised ONOE design.
            </div>
          </div>
          <div class="panel-tag">Synthetic simulation · Not legal advice</div>
        </div>

        <div class="scenario-strip">
          <div class="scenario-toggle">
            <button class="scenario-btn scenario-btn-active" data-scenario="current">Current system</button>
            <button class="scenario-btn" data-scenario="onoe">Synchronised ONOE</button>
          </div>
          <div class="scenario-badge" id="scenario-tag-text">
            Viewing: Current system as baseline, ONOE as comparative scenario.
          </div>
        </div>

        <div class="kpi-grid" id="kpi-grid"></div>

        <div class="chart-section">
          <div class="chart-shell">
            <div class="chart-header-text" id="chart-title">
              Metro‑wise effective turnout vs admin load
            </div>
            <div class="chart-subtext" id="chart-subtext">
              Paired bars show effective turnout (left scale) and administrative stress (right scale) for each city.
            </div>

            <div class="chart-area">
              <div class="chart-grid"></div>
              <div class="chart-inner">
                <div class="chart-root" id="chart-root"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="verdict-text" id="verdict-text"></div>
      </section>

      <!-- RIGHT: aggregated design cards -->
      <section class="glass-panel-soft">
        <div class="right-panel-inner">
          <h2 style="font-size:0.92rem;margin-bottom:4px;">Design stress dashboard</h2>
          <p class="right-intro" id="right-intro">
            The same scenario controls drive governance, administrative, financial, and constitutional indicators
            below. Use this to sense whether ONOE remains inside a stable design envelope.
          </p>

          <div class="metric-stack" id="metric-stack"></div>
        </div>
      </section>
    </main>

    <footer>© 2025 NirvachanNex – ONOE Impact Simulator · Scenario Overview</footer>
  </div>

  <!-- Tooltip container -->
  <div id="chart-tooltip"></div>

  <script>
    // --- DATA (condensed; plug exact values from your docs if needed) ---
    const cities = [
      { name: "Mumbai",     voters: 9.8, turnout: 55.4, polls: 3, fatigueDrop: 4,  adminStress: 8.5 },
      { name: "Delhi (NCT)",voters:14.3, turnout: 60.6, polls: 3, fatigueDrop: 6,  adminStress: 9.0 },
      { name: "Bengaluru",  voters: 9.5, turnout: 54.1, polls: 3, fatigueDrop: 3,  adminStress: 8.0 },
      { name: "Hyderabad",  voters: 4.0, turnout: 44.8, polls: 3, fatigueDrop: 2,  adminStress: 7.5 },
      { name: "Chennai",    voters: 3.8, turnout: 59.1, polls: 2, fatigueDrop: 1,  adminStress: 6.5 },
      { name: "Kolkata",    voters: 3.3, turnout: 65.2, polls: 3, fatigueDrop: 2,  adminStress: 9.5 },
      { name: "Ahmedabad",  voters: 3.9, turnout: 62.7, polls: 2, fatigueDrop: 2,  adminStress: 7.0 },
      { name: "Pune",       voters: 3.3, turnout: 49.9, polls: 3, fatigueDrop: 4,  adminStress: 8.0 },
      { name: "Surat",      voters: 3.1, turnout: 64.5, polls: 2, fatigueDrop: 1,  adminStress: 6.5 },
      { name: "Jaipur",     voters: 4.1, turnout: 68.5, polls: 2, fatigueDrop: 2,  adminStress: 7.0 }
    ];

    const params = {
      mccDaysPerElection: 50,
      onoeWindowDays: 65,
      fatigueReductionONOE: 0.7,
      adminReductionONOE: 0.8,
      logisticsSavingONOE: 0.9
    };

    let activeScenario = "current"; // "current" or "onoe"

    function computeScenarioMetrics(scenario) {
      const fatigueFactor = scenario === "current" ? 1 : params.fatigueReductionONOE;
      const adminFactor   = scenario === "current" ? 1 : params.adminReductionONOE;

      let totalMccDays = 0;
      let turnoutSum   = 0;
      let adminSum     = 0;
      let votersSum    = 0;

      const perCity = cities.map(c => {
        const polls = c.polls;
        const mcc   =
          scenario === "current"
            ? polls * params.mccDaysPerElection
            : params.onoeWindowDays;

        const effTurnout = c.turnout - c.fatigueDrop * fatigueFactor;
        const adminLoad  = c.adminStress * polls * adminFactor;

        totalMccDays += mcc;
        turnoutSum   += effTurnout;
        adminSum     += adminLoad;
        votersSum    += c.voters;

        return {
          name: c.name,
          mcc,
          effTurnout,
          adminLoad,
          voters: c.voters
        };
      });

      const avgEffTurnout   = turnoutSum / cities.length;
      const avgAdminLoad    = adminSum / cities.length;
      const governanceIndex = (1 - totalMccDays / (5 * 365)) * 100;

      return {
        totalMccDays,
        avgEffTurnout,
        avgAdminLoad,
        governanceIndex,
        perCity,
        votersSum
      };
    }

    function computeDelta() {
      const cur  = computeScenarioMetrics("current");
      const onoe = computeScenarioMetrics("onoe");

      return {
        cur,
        onoe,
        dMcc:  onoe.totalMccDays  - cur.totalMccDays,
        dTurn: onoe.avgEffTurnout - cur.avgEffTurnout,
        dAdmin:onoe.avgAdminLoad  - cur.avgAdminLoad,
        dGov:  onoe.governanceIndex - cur.governanceIndex
      };
    }

    const kpiGrid     = document.getElementById("kpi-grid");
    const chartRoot   = document.getElementById("chart-root");
    const verdictText = document.getElementById("verdict-text");
    const scenarioTagText = document.getElementById("scenario-tag-text");
    const metricStack = document.getElementById("metric-stack");
    const tooltipEl   = document.getElementById("chart-tooltip");

    function renderKPIs() {
      kpiGrid.innerHTML = "";
      const { cur, onoe } = computeDelta();
      const base  = activeScenario === "current" ? cur : onoe;
      const other = activeScenario === "current" ? onoe : cur;
      const signDir = activeScenario === "current" ? 1 : -1;

      const cards = [
        {
          label: "Total MCC days · 5 yrs",
          value: base.totalMccDays,
          delta: (other.totalMccDays - base.totalMccDays) * signDir,
          unit: " days",
          better: "lower"
        },
        {
          label: "Avg effective turnout",
          value: base.avgEffTurnout,
          delta: (other.avgEffTurnout - base.avgEffTurnout) * signDir,
          unit: " %",
          better: "higher"
        },
        {
          label: "Avg admin stress index",
          value: base.avgAdminLoad,
          delta: (other.avgAdminLoad - base.avgAdminLoad) * signDir,
          unit: "",
          better: "lower"
        },
        {
          label: "Governance continuity index",
          value: base.governanceIndex,
          delta: (other.governanceIndex - base.governanceIndex) * signDir,
          unit: " /100",
          better: "higher"
        },
        {
          label: "Total metro voters",
          value: base.votersSum,
          delta: 0,
          unit: " M",
          better: "na"
        },
        {
          label: "Simulation baseline",
          value: activeScenario === "current" ? 1 : 2,
          delta: 0,
          unit: "",
          better: "na"
        }
      ];

      cards.forEach(card => {
        const edge =
          card.better === "na"
            ? ""
            : card.delta === 0
            ? " · Neutral"
            : (card.better === "higher" && card.delta > 0) ||
              (card.better === "lower" && card.delta < 0)
            ? " · Other scenario edge"
            : " · Current view edge";

        const div = document.createElement("div");
        div.className = "kpi-card";
        div.innerHTML = `
          <div class="kpi-label">${card.label}</div>
          <div class="kpi-value">${card.value.toFixed(1)}${card.unit}</div>
          <div class="kpi-delta">
            ${card.delta === 0 ? "Δ 0.0" : "Δ " + (card.delta >= 0 ? "+" : "") + card.delta.toFixed(1)}
            ${card.unit}${edge}
          </div>
        `;
        kpiGrid.appendChild(div);
      });

      scenarioTagText.textContent =
        activeScenario === "current"
          ? "Viewing: Current staggered system as baseline. Δ shows ONOE relative movement."
          : "Viewing: ONOE as baseline. Δ shows how the current system differs from ONOE.";
    }

    function showTooltip(x, y, title, lines) {
      tooltipEl.innerHTML = `
        <div id="chart-tooltip-title">${title}</div>
        <div id="chart-tooltip-lines">${lines.join("<br/>")}</div>
      `;
      tooltipEl.style.left = x + 12 + "px";
      tooltipEl.style.top  = y + 12 + "px";
      tooltipEl.style.display = "block";
    }

    function hideTooltip() {
      tooltipEl.style.display = "none";
    }

    function renderChart() {
      chartRoot.innerHTML = "";

      const { cur, onoe } = computeDelta();
      const base  = activeScenario === "current" ? cur  : onoe;
      const other = activeScenario === "current" ? onoe : cur;

      const height = chartRoot.clientHeight || 160;
      const barWidth = 12;
      const groupWidth = barWidth * 3 + 8;
      const totalWidth = chartRoot.clientWidth || 640;
      const x0 = 8;
      const gap =
        (totalWidth - x0 * 2 - groupWidth * base.perCity.length) /
        Math.max(base.perCity.length - 1, 1);

      let maxTurn = 0;
      let maxAdmin = 0;
      base.perCity.forEach((b, i) => {
        const o = other.perCity[i];
        maxTurn = Math.max(maxTurn, b.effTurnout, o.effTurnout);
        maxAdmin = Math.max(maxAdmin, b.adminLoad, o.adminLoad);
      });

      base.perCity.forEach((b, idx) => {
        const o = other.perCity[idx];
        const xBase = x0 + idx * (groupWidth + gap);

        const curH   = (b.effTurnout / maxTurn) * (height * 0.9);
        const otherH = (o.effTurnout / maxTurn) * (height * 0.9);
        const adminH = (b.adminLoad / maxAdmin) * (height * 0.9);

        const attachTooltip = (barEl, payload) => {
          barEl.addEventListener("mousemove", e => {
            showTooltip(e.clientX, e.clientY, payload.title, payload.lines);
          });
          barEl.addEventListener("mouseleave", hideTooltip);
        };

        const barA = document.createElement("div");
        barA.className = "bar " + (activeScenario === "current" ? "bar-current" : "bar-sync");
        barA.style.left = xBase + "px";
        barA.style.width = barWidth + "px";
        barA.style.height = curH + "px";
        attachTooltip(barA, {
          title: b.name + " · " + (activeScenario === "current" ? "Current system" : "ONOE"),
          lines: [
            "Effective turnout: " + b.effTurnout.toFixed(1) + " %",
            "Admin stress index: " + b.adminLoad.toFixed(1),
            "MCC days (city): " + b.mcc.toFixed(0)
          ]
        });
        chartRoot.appendChild(barA);

        const barB = document.createElement("div");
        barB.className = "bar " + (activeScenario === "current" ? "bar-sync" : "bar-current");
        barB.style.left = xBase + barWidth + 3 + "px";
        barB.style.width = barWidth + "px";
        barB.style.height = otherH + "px";
        attachTooltip(barB, {
          title: b.name + " · " + (activeScenario === "current" ? "ONOE" : "Current system"),
          lines: [
            "Effective turnout: " + o.effTurnout.toFixed(1) + " %",
            "Admin stress index: " + o.adminLoad.toFixed(1),
            "MCC days (city): " + o.mcc.toFixed(0)
          ]
        });
        chartRoot.appendChild(barB);

        const barC = document.createElement("div");
        barC.className = "bar bar-secondary";
        barC.style.left = xBase + barWidth * 2 + 6 + "px";
        barC.style.width = barWidth + "px";
        barC.style.height = adminH + "px";
        attachTooltip(barC, {
          title: b.name + " · Admin load",
          lines: [
            "Admin stress index: " + b.adminLoad.toFixed(1),
            "Turnout (viewed scenario): " + b.effTurnout.toFixed(1) + " %",
            "Registered voters: " + b.voters.toFixed(1) + " M"
          ]
        });
        chartRoot.appendChild(barC);

        const label = document.createElement("div");
        label.className = "bar-label";
        label.style.left = xBase + groupWidth / 2 + "px";
        label.style.bottom = "-18px";
        label.textContent = b.name.split(" ")[0];
        chartRoot.appendChild(label);

        const val = document.createElement("div");
        val.className = "bar-value";
        val.style.left = xBase + barWidth / 2 + "px";
        val.style.bottom = curH + 6 + "px";
        val.textContent = b.effTurnout.toFixed(0) + "%";
        chartRoot.appendChild(val);
      });

      const govShift = onoe.governanceIndex - cur.governanceIndex;
      verdictText.textContent =
        "Hover any bar to see city‑wise turnout, administrative stress and MCC days in the selected view. " +
        "Overall, switching from the current system to ONOE shifts the governance continuity index by " +
        (govShift >= 0 ? "+" : "") +
        govShift.toFixed(1) +
        " points and changes total MCC days by " +
        (onoe.totalMccDays - cur.totalMccDays >= 0 ? "+" : "") +
        (onoe.totalMccDays - cur.totalMccDays).toFixed(1) +
        " days over five years.";
    }

    function renderRightDashboard() {
      metricStack.innerHTML = "";
      const { cur, onoe, dMcc, dTurn, dAdmin, dGov } = computeDelta();

      const stressScore =
        (Math.abs(dMcc) / (5 * 365)) * 35 +
        (Math.abs(dAdmin) / (cur.avgAdminLoad || 1)) * 25 +
        (Math.abs(dTurn) / (cur.avgEffTurnout || 1)) * 20 +
        (Math.abs(dGov) / 100) * 20;

      const cards = [
        {
          title: "Cycle alignment",
          icon: "◎",
          color: "linear-gradient(135deg,#4ef2ff,#88ffea)",
          value: (100 - Math.abs(dMcc) / (5 * 365) * 100).toFixed(1) + " %",
          caption:
            "Higher means MCC time remains concentrated in a single national window rather than scattered mini‑elections.",
          ratio: Math.max(0, 1 - Math.abs(dMcc) / (5 * 365))
        },
        {
          title: "Admin burden drift",
          icon: "⚙",
          color: "linear-gradient(135deg,#ffc857,#ff8f57)",
          value: dAdmin.toFixed(1),
          caption:
            "Average change in staff‑fatigue index across metros; negative values mean ONOE eases the burden.",
          ratio: Math.min(1, Math.abs(dAdmin) / (cur.avgAdminLoad || 1))
        },
        {
          title: "Turnout resilience",
          icon: "⬈",
          color: "linear-gradient(135deg,#9c6bff,#4ef2ff)",
          value: dTurn.toFixed(1) + " pts",
          caption:
            "Change in average effective turnout once voter‑fatigue effects are applied between scenarios.",
          ratio: Math.min(1, Math.abs(dTurn) / (cur.avgEffTurnout || 1))
        },
        {
          title: "Design stress score",
          icon: "⚖",
          color: "linear-gradient(135deg,#ff4fa0,#9c6bff)",
          value: stressScore.toFixed(1) + " /100",
          caption:
            "Composite pressure indicator combining MCC drift, administrative load, turnout shift and governance index.",
          ratio: Math.min(1, stressScore / 100)
        }
      ];

      cards.forEach(card => {
        const div = document.createElement("div");
        div.className = "metric-card";

        const top = document.createElement("div");
        top.className = "metric-top";

        const title = document.createElement("div");
        title.className = "metric-title";
        title.textContent = card.title;

        const icon = document.createElement("div");
        icon.className = "metric-icon";
        icon.style.background = card.color;
        icon.textContent = card.icon;

        top.appendChild(title);
        top.appendChild(icon);

        const value = document.createElement("div");
        value.className = "metric-value";
        value.textContent = card.value;

        const caption = document.createElement("div");
        caption.className = "metric-caption";
        caption.textContent = card.caption;

        const bar = document.createElement("div");
        bar.className = "metric-bar";

        const fill = document.createElement("div");
        fill.className = "metric-bar-fill";
        fill.style.background = card.color;
        fill.style.width = Math.max(6, card.ratio * 100) + "%";

        bar.appendChild(fill);

        div.appendChild(top);
        div.appendChild(value);
        div.appendChild(caption);
        div.appendChild(bar);

        metricStack.appendChild(div);
      });
    }

    function renderAll() {
      renderKPIs();
      renderChart();
      renderRightDashboard();
    }

    document.querySelectorAll(".scenario-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".scenario-btn").forEach(b => b.classList.remove("scenario-btn-active"));
        btn.classList.add("scenario-btn-active");
        activeScenario = btn.dataset.scenario;
        renderAll();
      });
    });

    window.addEventListener("resize", renderChart);
    renderAll();
  </script>
</body>
</html>
