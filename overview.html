<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NIRVACHANNEX – ONOE Scenario Overview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="ui-system.css" />
  <style>
    /* Pop-up Tooltip Style (Bottom-Left) */
    #chart-tooltip {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 280px;
      background: rgba(10, 15, 30, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(8px);
      z-index: 1000;
      display: none;
      pointer-events: none;
      font-family: 'Inter', system-ui, sans-serif;
      animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .tooltip-header {
      font-size: 0.95rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .tooltip-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
      font-size: 0.85rem;
      color: #94a3b8;
    }
    
    .tooltip-val {
      color: #e2e8f0;
      font-weight: 600;
    }
    
    .bar {
      transition: height 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- Header -->
    <header class="app-header">
      <div class="brand-block">
        <div class="brand-logo">
          <img src="nirvachan logo.jpg" alt="NirvachanNex logo" />
        </div>
        <div>
          <div class="brand-text-main">NIRVACHANNEX</div>
          <div class="brand-text-sub">ONE NATION · ONE ELECTION</div>
        </div>
      </div>
      <nav class="app-nav">
        <a class="nav-pill nav-active" href="overview.html">Overview</a>
        <a class="nav-pill" href="governance.html">Governance</a>
        <a class="nav-pill" href="administrative.html">Administrative</a>
        <a class="nav-pill" href="financial.html">Financial</a>
        <a class="nav-pill" href="constitutional.html">Constitutional</a>
        <a href="delhi.html" class="nav-pill">Delhi Module</a>
        <a class="nav-pill nav-active" href="stakeholders.html">Stakeholders</a>
      </nav>
    </header>

    <main class="overview-grid">
      <!-- LEFT: main scenario view -->
      <section class="glass-panel">
        <div class="panel-glow"></div>
        <div class="panel-header">
          <div class="panel-title-block">
            <div class="panel-title">Scenario overview</div>
            <div class="panel-subtitle">
              Compare governance, administrative, financial, and constitutional signals for the current staggered
              system versus a synchronised ONOE design.
            </div>
          </div>
          <div class="panel-tag">Synthetic simulation · Not legal advice</div>
        </div>

        <div class="scenario-strip">
          <div class="scenario-toggle">
            <button class="scenario-btn scenario-btn-active" data-scenario="current">Current system</button>
            <button class="scenario-btn" data-scenario="onoe">Synchronised ONOE</button>
          </div>
          <div class="scenario-badge" id="scenario-tag-text">
            Viewing: Current system as baseline, ONOE as comparative scenario.
          </div>
        </div>

        <div class="kpi-grid" id="kpi-grid"></div>

        <div class="chart-section">
          <div class="chart-shell">
            <div class="chart-header-text" id="chart-title">
              Metro‑wise effective turnout vs admin load
            </div>
            <div class="chart-subtext" id="chart-subtext">
              Paired bars show effective turnout (left scale) and administrative stress (right scale) for each city.
            </div>

            <div class="chart-area">
              <div class="chart-grid"></div>
              <div class="chart-inner">
                <div class="chart-root" id="chart-root"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="verdict-text" id="verdict-text"></div>
      </section>

      <!-- RIGHT: aggregated design cards -->
      <section class="glass-panel-soft">
        <div class="right-panel-inner">
          <h2 style="font-size:0.92rem;margin-bottom:4px;">Design stress dashboard</h2>
          <p class="right-intro" id="right-intro">
            The same scenario controls drive governance, administrative, financial, and constitutional indicators
            below. Use this to sense whether ONOE remains inside a stable design envelope.
          </p>

          <div class="metric-stack" id="metric-stack"></div>
        </div>
      </section>
    </main>

    <footer>© 2025 NirvachanNex – ONOE Impact Simulator · Scenario Overview</footer>
  </div>

  <!-- Pop-up Tooltip Container -->
  <div id="chart-tooltip"></div>

  <script>
    // --- DATA: 10 Cities ---
    const cities = [
      { name: "Mumbai",     voters: 9.8,  turnout: 55.4, polls: 3, fatigueDrop: 4,  adminStress: 8.5 },
      { name: "Delhi",      voters: 14.3, turnout: 60.6, polls: 3, fatigueDrop: 6,  adminStress: 9.0 },
      { name: "Bengaluru",  voters: 9.5,  turnout: 54.1, polls: 3, fatigueDrop: 3,  adminStress: 8.0 },
      { name: "Hyderabad",  voters: 4.0,  turnout: 44.8, polls: 3, fatigueDrop: 2,  adminStress: 7.5 },
      { name: "Chennai",    voters: 3.8,  turnout: 59.1, polls: 2, fatigueDrop: 1,  adminStress: 6.5 },
      { name: "Kolkata",    voters: 3.3,  turnout: 65.2, polls: 3, fatigueDrop: 2,  adminStress: 9.5 },
      { name: "Ahmedabad",  voters: 3.9,  turnout: 62.7, polls: 2, fatigueDrop: 2,  adminStress: 7.0 },
      { name: "Pune",       voters: 3.3,  turnout: 49.9, polls: 3, fatigueDrop: 4,  adminStress: 8.0 },
      { name: "Surat",      voters: 3.1,  turnout: 64.5, polls: 2, fatigueDrop: 1,  adminStress: 6.5 },
      { name: "Jaipur",     voters: 4.1,  turnout: 68.5, polls: 2, fatigueDrop: 2,  adminStress: 7.0 }
    ];

    // MCC assumptions revised to keep totals realistic:
    // Current: ~30 days per major election; ONOE: single ~45‑day window in 5 years.
    const params = {
      mccDaysPerElection: 30,   // per election, realistic short window
      onoeWindowDays: 45,       // one combined ONOE window over 5 years
      fatigueReductionONOE: 0.7,
      adminReductionONOE: 0.6
    };

    let activeScenario = "current";

    function computeScenarioMetrics(scenario) {
      const fatigueFactor = scenario === "current" ? 1 : params.fatigueReductionONOE;
      const adminFactor   = scenario === "current" ? 1 : params.adminReductionONOE;

      let totalMccDays = 0;
      let turnoutSum   = 0;
      let adminSum     = 0;
      let votersSum    = 0;

      const perCity = cities.map(c => {
        const polls = c.polls;
        // With these numbers, typical total MCC over 5 years stays in a few hundred days, not 1300+.
        const mcc = scenario === "current" ? polls * params.mccDaysPerElection : params.onoeWindowDays;

        const effTurnout = c.turnout - (c.fatigueDrop * fatigueFactor);
        const adminLoad  = c.adminStress * adminFactor;

        totalMccDays += mcc;
        turnoutSum   += effTurnout;
        adminSum     += adminLoad;
        votersSum    += c.voters;

        return {
          name: c.name,
          mcc,
          effTurnout,
          adminLoad,
          voters: c.voters
        };
      });

      const avgEffTurnout   = turnoutSum / cities.length;
      const avgAdminLoad    = adminSum / cities.length;
      const governanceIndex = (1 - totalMccDays / (5 * 365)) * 100;

      return {
        totalMccDays,
        avgEffTurnout,
        avgAdminLoad,
        governanceIndex,
        perCity,
        votersSum
      };
    }

    function computeDelta() {
      const cur = computeScenarioMetrics("current");
      const onoe = computeScenarioMetrics("onoe");
      return { cur, onoe };
    }

    const kpiGrid         = document.getElementById("kpi-grid");
    const chartRoot       = document.getElementById("chart-root");
    const verdictText     = document.getElementById("verdict-text");
    const scenarioTagText = document.getElementById("scenario-tag-text");
    const metricStack     = document.getElementById("metric-stack");
    const tooltipEl       = document.getElementById("chart-tooltip");

    function renderKPIs() {
      kpiGrid.innerHTML = "";
      const { cur, onoe } = computeDelta();
      const base = activeScenario === "current" ? cur : onoe;
      
      const cards = [
        {
          label: "Total MCC days · 5 yrs",
          value: base.totalMccDays,
          delta: activeScenario === "current"
            ? (onoe.totalMccDays - cur.totalMccDays)
            : (cur.totalMccDays - onoe.totalMccDays), 
          unit: " days",
          better: "lower"
        },
        {
          label: "Avg effective turnout",
          value: base.avgEffTurnout,
          delta: activeScenario === "current"
            ? (onoe.avgEffTurnout - cur.avgEffTurnout)
            : (cur.avgEffTurnout - onoe.avgEffTurnout),
          unit: " %",
          better: "higher"
        },
        {
          label: "Avg admin stress index",
          value: base.avgAdminLoad,
          delta: activeScenario === "current"
            ? (onoe.avgAdminLoad - cur.avgAdminLoad)
            : (cur.avgAdminLoad - onoe.avgAdminLoad),
          unit: "",
          better: "lower"
        },
        {
          label: "Governance continuity index",
          value: base.governanceIndex,
          delta: activeScenario === "current"
            ? (onoe.governanceIndex - cur.governanceIndex)
            : (cur.governanceIndex - onoe.governanceIndex),
          unit: " /100",
          better: "higher"
        },
        {
          label: "Total metro voters",
          value: base.votersSum,
          delta: 0,
          unit: " M",
          better: "na"
        },
        {
          label: "Simulation baseline",
          value: activeScenario === "current" ? 1.0 : 2.0,
          delta: 0,
          unit: "",
          better: "na"
        }
      ];

      cards.forEach(card => {
        let edge = "";
        if (card.better !== "na" && card.delta !== 0) {
          const isPositive = card.delta > 0;
          const isGood = (card.better === "higher" && isPositive) || (card.better === "lower" && !isPositive);
          edge = isGood ? " · ONOE edge" : "";
        }

        const div = document.createElement("div");
        div.className = "kpi-card";
        div.innerHTML = `
          <div class="kpi-label">${card.label}</div>
          <div class="kpi-value">${card.value.toFixed(1)}${card.unit}</div>
          <div class="kpi-delta">
            ${card.delta === 0 ? "Δ 0.0" : "Δ " + (card.delta > 0 ? "+" : "") + card.delta.toFixed(1)}
            ${card.unit}${edge}
          </div>
        `;
        kpiGrid.appendChild(div);
      });

      scenarioTagText.textContent =
        activeScenario === "current"
          ? "Viewing: Current staggered system as baseline. Δ shows ONOE potential."
          : "Viewing: Synchronised ONOE scenario.";
    }

    function renderChart() {
      chartRoot.innerHTML = "";
      const height = chartRoot.clientHeight || 160;
      const barWidth = 12;
      const groupWidth = barWidth * 3 + 8;
      const totalWidth = chartRoot.clientWidth || 640;
      const gap = (totalWidth - 20 - groupWidth * 10) / 9;

      const { cur, onoe } = computeDelta();
      const dataToRender = activeScenario === "current" ? cur.perCity : onoe.perCity;
      
      dataToRender.forEach((d, i) => {
        const xBase = 10 + i * (groupWidth + gap);
        
        // Turnout Bar (Cyan)
        const hTurn = (d.effTurnout / 100) * height; 
        const b1 = document.createElement("div");
        b1.className = "bar";
        b1.style.left = xBase + "px";
        b1.style.width = barWidth + "px";
        b1.style.height = hTurn + "px";
        b1.style.background = "linear-gradient(180deg, #4ef2ff 0%, #2563eb 100%)";
        b1.addEventListener("mousemove", () => showTooltip(d, 'turnout'));
        b1.addEventListener("mouseleave", hideTooltip);
        chartRoot.appendChild(b1);

        // Admin Stress Bar (Purple)
        const hAdmin = (d.adminLoad / 10) * height; 
        const b2 = document.createElement("div");
        b2.className = "bar";
        b2.style.left = xBase + barWidth + 4 + "px";
        b2.style.width = barWidth + "px";
        b2.style.height = hAdmin + "px";
        b2.style.background = "linear-gradient(180deg, #d946ef 0%, #7c3aed 100%)";
        b2.addEventListener("mousemove", () => showTooltip(d, 'admin'));
        b2.addEventListener("mouseleave", hideTooltip);
        chartRoot.appendChild(b2);

        // Label
        const lbl = document.createElement("div");
        lbl.className = "bar-label";
        lbl.style.left = xBase + "px";
        lbl.style.bottom = "-20px";
        lbl.style.width = groupWidth + "px";
        lbl.style.textAlign = "center";
        lbl.style.fontSize = "10px";
        lbl.innerText = d.name.substring(0,3).toUpperCase();
        chartRoot.appendChild(lbl);
      });
      
      const govShift = onoe.governanceIndex - cur.governanceIndex;
      verdictText.innerHTML = activeScenario === "current" 
        ? "<strong>Status Quo:</strong> High administrative load (purple bars) and frequent elections reduce effective governance time."
        : `<strong>ONOE Impact:</strong> Governance continuity improves by <strong>+${govShift.toFixed(1)} points</strong>, with MCC time reduced to more realistic, consolidated windows instead of long scattered periods.`;
    }

    function renderRightDashboard() {
      metricStack.innerHTML = "";
      const { cur, onoe } = computeDelta();
      
      const isOnoe = activeScenario === "onoe";
      
      const alignVal = isOnoe ? 90.0 : 25.0;
      const adminDrift = isOnoe ? (onoe.avgAdminLoad - cur.avgAdminLoad) : 0; 
      const turnRes = isOnoe ? (onoe.avgEffTurnout - cur.avgEffTurnout) : 0;
      const stressScore = isOnoe ? 30.0 : 80.0;

      const cards = [
        {
          title: "Cycle alignment",
          icon: "◎",
          color: "linear-gradient(135deg,#4ef2ff,#88ffea)",
          value: alignVal.toFixed(1) + " %",
          caption: "Higher means MCC time remains concentrated in a single national window.",
          ratio: alignVal / 100
        },
        {
          title: "Admin burden drift",
          icon: "⚙",
          color: "linear-gradient(135deg,#ffc857,#ff8f57)",
          value: adminDrift.toFixed(1),
          caption: "Average change in staff‑fatigue index across metros (negative = improvement).",
          ratio: Math.min(Math.abs(adminDrift) / 5, 1)
        },
        {
          title: "Turnout resilience",
          icon: "⬈",
          color: "linear-gradient(135deg,#9c6bff,#4ef2ff)",
          value: turnRes.toFixed(1) + " pts",
          caption: "Gain in effective turnout due to reduced voter fatigue.",
          ratio: Math.min(Math.abs(turnRes) / 5, 1)
        },
        {
          title: "Design stress score",
          icon: "⚖",
          color: "linear-gradient(135deg,#ff4fa0,#9c6bff)",
          value: stressScore.toFixed(1) + " /100",
          caption: "Composite pressure indicator (Lower is better for stability).",
          ratio: stressScore / 100
        }
      ];

      cards.forEach(card => {
        const div = document.createElement("div");
        div.className = "metric-card";
        div.innerHTML = `
            <div class="metric-top">
                <div class="metric-title">${card.title}</div>
                <div class="metric-icon" style="background:${card.color}">${card.icon}</div>
            </div>
            <div class="metric-value">${card.value}</div>
            <div class="metric-caption">${card.caption}</div>
            <div class="metric-bar">
                <div class="metric-bar-fill" style="background:${card.color}; width:${card.ratio * 100}%"></div>
            </div>
        `;
        metricStack.appendChild(div);
      });
    }

    function showTooltip(data, type) {
      const scenarioLabel = activeScenario === "current" ? "Current System" : "ONOE";
      
      let content = "";
      if (type === 'turnout') {
        content = `
          <div class="tooltip-header">
             ${data.name} · <span style="font-weight:400; color:#94a3b8">${scenarioLabel}</span>
          </div>
          <div class="tooltip-row">
              <span>Effective turnout:</span>
              <span class="tooltip-val" style="color:#4ef2ff">${data.effTurnout.toFixed(1)} %</span>
          </div>
          <div style="font-size:0.75rem; color:#64748b; margin-top:4px;">
            ${activeScenario === "current" ? "Reduced by repeated election fatigue" : "Improved by fewer, more focused elections"}
          </div>
        `;
      } else if (type === 'admin') {
        content = `
          <div class="tooltip-header">
             ${data.name} · <span style="font-weight:400; color:#94a3b8">${scenarioLabel}</span>
          </div>
          <div class="tooltip-row">
              <span>Admin stress index:</span>
              <span class="tooltip-val" style="color:#d946ef">${data.adminLoad.toFixed(1)} / 10</span>
          </div>
          <div style="font-size:0.75rem; color:#64748b; margin-top:4px;">
            ${activeScenario === "current" ? "Higher burden from multiple polls" : "Lower burden with a single cycle"}
          </div>
        `;
      }

      tooltipEl.innerHTML = content;
      tooltipEl.style.display = "block";
    }
    
    function hideTooltip() { tooltipEl.style.display = "none"; }

    function renderAll() {
      renderKPIs();
      renderChart();
      renderRightDashboard();
    }

    document.querySelectorAll(".scenario-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".scenario-btn").forEach(b => b.classList.remove("scenario-btn-active"));
        btn.classList.add("scenario-btn-active");
        activeScenario = btn.dataset.scenario;
        renderAll();
      });
    });

    window.addEventListener("resize", renderChart);
    renderAll();
  </script>
</body>
</html>
